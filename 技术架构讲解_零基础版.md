# 山海诗馆 技术架构讲解（零基础版）

> 这份文档专为完全零代码基础的朋友准备，用最通俗的语言解释这个 App 是如何工作的。

---

## 📱 项目概览

**山海诗馆**是一款现代诗创作与分享 iOS 应用，提供：
- ✍️ 三种创作模式（直接写诗、模仿写诗、主题写诗）
- 🤖 AI 智能点评
- 📖 诗歌学习内容
- 🌐 诗歌广场与社交
- 👤 个人作品管理

---

## 🏗️ 技术架构（像搭房子一样理解）

### 1. **基础材料（编程语言）**

**Swift**
- **是什么**：苹果公司开发的编程语言，专门用于开发 iOS/Mac 应用
- **为什么用它**：就像建房子要用砖头水泥一样，开发苹果应用必须用 Swift
- **类比**：如果把编程比作写作，Swift 就是"中文"，它有自己的语法规则

---

### 2. **建筑框架（SwiftUI）**

**SwiftUI = Swift + UI（User Interface，用户界面）**

- **是什么**：苹果提供的界面搭建工具
- **做什么**：用代码"画"出 App 的每一个页面、按钮、文字
- **类比**：
  - 传统方式 = 用画笔一笔一笔画界面（慢且复杂）
  - SwiftUI = 用乐高积木拼界面（快且直观）

**举例说明**：
```swift
Text("山海诗馆")
    .font(.titleLarge)
    .foregroundColor(.black)
```
这三行代码的意思：
1. 显示文字"山海诗馆"
2. 用大标题字体
3. 颜色是黑色

---

### 3. **房间布局（项目结构）**

我们的 App 像一栋房子，分成不同的房间：

```
山海诗馆/
├── Models/              【数据房间】存放数据结构
├── Views/               【界面房间】所有页面
│   ├── Landing/         入口页（引导页）
│   ├── Writing/         写诗模块
│   ├── Learning/        学诗模块
│   ├── Explore/         赏诗模块
│   ├── Profile/         我的页面
│   └── Shared/          共用组件
├── Services/            【工具房间】AI 服务等
└── Utilities/           【配置房间】颜色、字体等设置
```

---

## 🧱 核心组件详解

### 一、数据层（Models）—— App 的"大脑记忆"

#### 1. **Poem.swift - 诗歌数据模型**

**用人话说**：定义了"什么是一首诗"

就像身份证定义了一个人的基本信息（姓名、性别、出生日期），`Poem` 定义了一首诗包含什么：

```swift
struct Poem {
    let id: String              // 诗歌唯一编号（像身份证号）
    var title: String           // 标题
    var content: String         // 诗歌内容
    var authorName: String      // 作者笔名
    var createdAt: Date         // 创作时间
    var tags: [String]          // 标签（如：风、雨、城市）
    var likeCount: Int          // 点赞数
    var isLiked: Bool           // 我有没有点赞
    var isFavorited: Bool       // 我有没有收藏
    var isPublished: Bool       // 是发布状态还是草稿
}
```

**为什么需要这个**：
- 统一格式：所有诗歌都按这个模板存储，就像所有人的身份证格式都一样
- 方便管理：程序知道哪个是标题、哪个是内容

---

#### 2. **PoemManager.swift - 诗歌管理器**

**用人话说**：诗歌的"图书管理员"

想象一个图书馆的管理员，他负责：
- 📥 **借书**：读取诗歌
- 📤 **还书**：保存诗歌
- 🗑️ **删书**：删除诗歌
- 🔍 **找书**：搜索诗歌
- 📊 **统计**：有多少诗、多少草稿

**关键技术：单例模式（Singleton）**
```swift
static let shared = PoemManager()
```

**什么意思**：
- 全 App 只有一个图书管理员
- 无论在哪个页面，都找这同一个管理员借还书
- **好处**：数据统一，不会乱

**数据存储：UserDefaults**
- **是什么**：苹果提供的本地存储工具
- **类比**：手机里的一个小仓库，App 关闭后数据还在
- **存什么**：诗歌数据、用户笔名、设置等
- **缺点**：只能存小量数据（几百首诗没问题，几万首就不行了）

---

### 二、界面层（Views）—— App 的"外貌"

#### 1. **声明式 UI 思想**

**传统方式**（命令式）：
```
1. 创建一个按钮
2. 设置按钮文字为"发布"
3. 设置按钮颜色为蓝色
4. 设置按钮大小
5. 把按钮放到屏幕上
```

**SwiftUI 方式**（声明式）：
```swift
Button("发布") {
    // 点击后做什么
}
.foregroundColor(.blue)
.frame(width: 100)
```

**区别**：
- 传统：一步步告诉计算机"怎么做"（how）
- SwiftUI：直接说"我要什么"（what），系统自动处理

---

#### 2. **组件化思想**

把界面拆成可复用的小零件，就像乐高积木：

**举例**：诗歌卡片
```swift
struct PoemCard: View {
    let poem: Poem
    
    var body: some View {
        VStack {
            Text(poem.title)       // 标题
            Text(poem.content)      // 内容
            Text(poem.authorName)   // 作者
        }
    }
}
```

**使用**：
```swift
ForEach(poems) { poem in
    PoemCard(poem: poem)   // 复用！
}
```

**好处**：
- 写一次，到处用
- 修改方便（只改一个地方）
- 代码整洁

---

#### 3. **状态管理（@State, @StateObject）**

**这是什么**：让界面"活"起来的魔法

**@State - 状态变量**
```swift
@State private var title = ""  // 诗歌标题

TextField("输入标题", text: $title)
```

**什么意思**：
1. `title` 是一个变量，初始值为空字符串 `""`
2. 用户在输入框里打字
3. `title` 自动更新
4. 界面自动刷新

**类比**：
- 普通变量 = 死的纸质记录本
- @State 变量 = 活的电子屏幕，一改就自动更新

**@StateObject - 对象状态**
```swift
@StateObject private var poemManager = PoemManager.shared
```

**用途**：管理复杂的数据对象（如诗歌管理器）

---

### 三、服务层（Services）—— App 的"外部助手"

#### **AIService.swift - AI 点评服务**

**做什么**：调用 OpenAI 的 API 来点评诗歌

**流程**（像寄信一样）：
1. **写信**：把诗歌内容打包成请求
2. **寄信**：通过网络发送给 OpenAI
3. **等回信**：等待 AI 分析
4. **读回信**：解析 AI 的点评
5. **展示**：在 App 里显示点评

**关键代码**：
```swift
async throws -> String
```

**什么意思**：
- `async`：异步，不会卡住界面（像寄信，不用傻等）
- `throws`：可能出错（网络断了、API 挂了）
- `-> String`：返回一段文字（AI 的点评）

**API 调用过程**：
1. **准备请求**：
   ```swift
   "请点评这首诗：[诗歌内容]"
   ```
2. **发送请求**：
   ```swift
   URLSession.shared.data(for: request)  // 发送网络请求
   ```
3. **处理响应**：
   ```swift
   JSON 解析 → 提取点评文字 → 返回
   ```

---

### 四、配置层（Utilities）—— App 的"装修方案"

#### **Constants.swift - 常量配置**

**为什么要统一配置**：

**❌ 不好的做法**：每个地方都写一遍
```swift
// 页面 A
Text("标题").font(.system(size: 28))

// 页面 B
Text("标题").font(.system(size: 28))

// 页面 C
Text("标题").font(.system(size: 30))  // 不小心写错了！
```

**✅ 好的做法**：统一配置
```swift
// Constants.swift
enum Fonts {
    static func titleLarge() -> Font {
        .system(size: 32, weight: .light, design: .serif)
    }
}

// 到处使用
Text("标题").font(Fonts.titleLarge())
```

**好处**：
- 想改字号？改一个地方就行
- 保持视觉统一
- 不会出错

---

## 🔄 数据流向（信息怎么流动）

### 举例：用户写一首诗

```
1. 用户在编辑器输入 → title 和 content 变量更新
                    ↓
2. 点击"保存草稿"按钮 → 触发 saveDraft() 函数
                    ↓
3. 创建 Poem 对象   → 包含标题、内容、作者等信息
                    ↓
4. 调用 PoemManager → manager.createDraft(...)
                    ↓
5. 保存到本地存储  → UserDefaults（手机仓库）
                    ↓
6. 更新诗歌列表   → 界面自动刷新，显示新草稿
```

---

## 🎨 UI 设计原则（为什么这样设计）

### 1. **极简主义**
- **纯白背景**：干净、专注内容
- **大量留白**：呼吸感，不拥挤
- **细线条**：优雅、克制

### 2. **字体策略**
- **宋体（Serif）**：用于诗歌和标题，优雅、文艺
- **无衬线（Default）**：用于说明文字，现代、清晰
- **字重轻**（Light）：不厚重，有高级感
- **增大字号**：易读，有呼吸感

### 3. **配色方案**
```swift
主文字：#1A1A1A （几乎黑）
次要文字：#8E8E8E （优雅灰）
强调色：#2C3E50 （深灰蓝，克制）
背景：#FFFFFF （纯白）
```

**为什么不用鲜艳颜色**：
- 诗歌是安静的，需要专注
- 黑白灰更优雅、耐看
- 突出内容而非界面

---

## 🧩 核心功能实现

### 一、三种写诗模式

#### 1. **直接写诗（DirectWritingView）**
- **技术**：简单的文本编辑器
- **状态管理**：@State 管理标题和内容
- **自动保存**：onChange 监听变化

#### 2. **模仿写诗（MimicWritingView）**
- **技术**：分屏布局（上半部分参考诗，下半部分创作）
- **实现**：VStack 垂直堆叠 + Divider 分割线

#### 3. **主题写诗（ThemeWritingView）**
- **技术**：主题选择 + AI 建议
- **流程**：
  1. 选主题 → 
  2. 调用 AI API → 
  3. 获取创作建议 → 
  4. 展开创作

---

### 二、AI 点评功能

#### **技术栈**
- **API**：OpenAI GPT-4o-mini
- **协议**：HTTPS + JSON
- **异步处理**：async/await（Swift 的异步语法）

#### **为什么用 async/await**？

**问题**：网络请求很慢（可能几秒），会卡住界面

**传统方式**（回调地狱）：
```swift
requestAI(poem) { result in
    parseResult(result) { comment in
        updateUI(comment) { 
            // 层层嵌套，难读
        }
    }
}
```

**async/await 方式**（优雅）：
```swift
let result = await requestAI(poem)      // 等待结果
let comment = await parseResult(result)  // 等待解析
updateUI(comment)                        // 更新界面
```

**好处**：
- 代码像同步一样好读
- 实际是异步，不卡界面
- 错误处理简单（try-catch）

---

### 三、本地数据持久化

#### **UserDefaults - 轻量存储**

**用法**：
```swift
// 保存
UserDefaults.standard.set(data, forKey: "poems")

// 读取
let data = UserDefaults.standard.data(forKey: "poems")
```

**适用场景**：
- ✅ 设置、偏好
- ✅ 少量数据（几百条记录）
- ❌ 大量数据（建议用 CoreData 或 SQLite）

#### **JSON 序列化**

**问题**：Swift 对象无法直接存储

**解决**：转成 JSON（通用文本格式）

```swift
// Poem → JSON
let encoder = JSONEncoder()
let data = try encoder.encode(poem)

// JSON → Poem
let decoder = JSONDecoder()
let poem = try decoder.decode(Poem.self, from: data)
```

**类比**：
- Swift 对象 = 活人（只在程序里活着）
- JSON = 照片（可以保存、传输）

---

## 📊 项目统计

### 代码规模
- **总文件数**：~25 个 Swift 文件
- **总代码行数**：~3000 行
- **界面组件数**：~15 个主要页面

### 功能模块
| 模块 | 文件数 | 核心功能 |
|------|--------|----------|
| 数据层 | 3 | Poem、PoemManager、LearningContent |
| 界面层 | 15+ | 学诗、写诗、赏诗、我的 |
| 服务层 | 1 | AI 服务 |
| 工具层 | 1 | 设计系统 |

---

## 🚀 技术亮点

### 1. **MVVM 架构**
- **M**odel：数据模型（Poem）
- **V**iew：界面（所有 View）
- **V**iew**M**odel：数据管理（PoemManager）

**为什么这样**：
- 数据和界面分离
- 易于测试
- 代码清晰

### 2. **响应式编程**
- 数据变 → 界面自动更新
- 基于 SwiftUI 的 @Published 和 @State

### 3. **组件化开发**
- 每个界面元素都是独立组件
- 可复用、可组合

### 4. **异步网络请求**
- async/await 语法
- 不阻塞主线程
- 优雅的错误处理

---

## 🔑 关键技术概念

### 1. **什么是"编译"**
- **人话**：把你写的代码翻译成手机能理解的机器语言
- **类比**：把中文翻译成英文
- **Xcode** 就是翻译官

### 2. **什么是"运行时"**
- **编译时**：代码翻译阶段（写完代码点"运行"后的几秒）
- **运行时**：App 真正运行时（在模拟器或真机上跑起来）

### 3. **什么是"调试"**
- **Debug**：找bug（错误）
- **工具**：
  - 打印（print）：在控制台输出信息
  - 断点：让程序暂停，检查变量值

### 4. **什么是"闭包"**
```swift
Button(action: {
    print("点击了")
})
```
大括号 `{}` 里的就是闭包，可以理解为：
- 一段可以传递的代码块
- 像把功能装在盒子里传给别人

---

## 📚 学习路径（如果你想深入）

### 第一阶段：基础（1-2 个月）
1. **Swift 语法**
   - 变量、常量
   - if/else、循环
   - 函数、结构体
   
2. **SwiftUI 基础**
   - Text、Button、Image
   - VStack、HStack
   - List、NavigationStack

### 第二阶段：进阶（2-3 个月）
1. **状态管理**
   - @State、@Binding
   - @StateObject、@ObservedObject
   
2. **网络请求**
   - URLSession
   - async/await
   - JSON 解析

### 第三阶段：高级（3+ 个月）
1. **架构模式**
   - MVVM
   - 依赖注入
   
2. **数据持久化**
   - UserDefaults
   - CoreData
   - SQLite

---

## 🛠️ 常见问题

### Q1：为什么要用那么多文件？
**A**：就像写书要分章节，代码分文件让结构清晰，易于维护。

### Q2：能不能用其他语言开发 iOS？
**A**：理论上可以（如 React Native），但 Swift 是官方推荐，性能最好。

### Q3：这个 App 能在 Android 上运行吗？
**A**：不能。SwiftUI 是苹果专有技术。要支持 Android 需要：
- 重写（用 Kotlin/Java）
- 或用跨平台框架（Flutter、React Native）

### Q4：AI 接口为什么要付费？
**A**：OpenAI 提供的是云端服务，每次调用都消耗他们的计算资源。

### Q5：数据存哪了？
**A**：存在手机本地（UserDefaults），不会上传云端，保护隐私。

---

## 💡 总结

### 这个项目用到的核心技术
1. **SwiftUI** - 界面框架
2. **MVVM** - 架构模式
3. **async/await** - 异步编程
4. **UserDefaults** - 本地存储
5. **URLSession** - 网络请求
6. **JSON** - 数据格式

### 项目特色
- ✅ 代码规范、注释清晰
- ✅ 模块化、可扩展
- ✅ UI 极简优雅
- ✅ 功能完整

### 可以改进的地方（未来扩展）
1. **云端同步**：用 iCloud 或自建服务器
2. **社交功能**：评论、关注、@
3. **更多 AI 功能**：续写、改写、风格转换
4. **iPad 适配**：大屏优化
5. **多语言**：英文、繁体

---

## 📝 附录：代码示例解读

### 示例1：创建一首诗
```swift
let poem = Poem(
    title: "夜晚",
    content: "星星点点\n照亮回家的路",
    authorName: "小明",
    tags: ["夜晚", "星空"],
    isPublished: true
)
```

**解读**：
- `Poem(...)` - 调用 Poem 的初始化函数
- `title: "夜晚"` - 参数名：参数值
- `\n` - 换行符
- `isPublished: true` - 布尔值，true=发布、false=草稿

---

### 示例2：显示诗歌列表
```swift
ScrollView {
    ForEach(poems) { poem in
        Text(poem.title)
    }
}
```

**解读**：
- `ScrollView` - 可滚动容器
- `ForEach(poems)` - 遍历 poems 数组
- `{ poem in ... }` - 对每首诗执行
- `Text(poem.title)` - 显示标题

---

### 示例3：点击事件
```swift
Button("发布") {
    publishPoem()
}
```

**解读**：
- `Button("发布")` - 按钮文字
- `{ publishPoem() }` - 点击后执行的代码

---

## 🎓 结语

这个项目虽然是给零基础的你看的，但实际上用到了很多专业的iOS开发技术。希望通过这份文档，你能：

1. **理解** App 是如何工作的
2. **欣赏** 代码的美感和逻辑
3. **激发** 对编程的兴趣

编程不是魔法，是严谨的逻辑 + 创造力的结合。

如果这份文档让你对编程产生了一点点兴趣，那它就成功了！🎉

---

**制作时间**：2025年10月21日  
**技术栈**：Swift 5.0 + SwiftUI + iOS 18  
**AI 辅助**：Claude Sonnet 4.5  

