# 🎯 诗歌操作重构方案 V2

## 核心原则

### ✅ 数据存储策略
- **本地存储**：草稿、诗集（全部本地）
- **云端存储**：仅广场发布的诗歌
- **简化逻辑**：不再区分登录前后的存储位置

---

## 📝 写诗页面流程

### 1. 写诗中
```
┌─────────────────────────────┐
│  [取消]     写诗     [?]    │
├─────────────────────────────┤
│                             │
│   标题：________________    │
│                             │
│   正文：                    │
│   ____________________      │
│   ____________________      │
│   ____________________      │
│                             │
│                             │
│         [ 保存 ]            │ ← 唯一按钮
│                             │
└─────────────────────────────┘
```

### 2. 点击"取消"（未保存）
```
┌─────────────────────────────┐
│   ⚠️  确认退出              │
│                             │
│   诗歌尚未保存              │
│                             │
│   [ 直接退出 ]  [ 继续写 ]  │
└─────────────────────────────┘

→ 点击"直接退出"
  ✅ 自动保存到草稿（本地）
  ✅ Toast: "已自动保存到草稿"
```

### 3. 点击"保存"
```
┌─────────────────────────────┐
│                             │
│     🖼️  生成的诗歌图片        │
│                             │
│       《标题》               │
│                             │
│      正文内容...             │
│                             │
│    ─ 作者名 · 日期 ─        │
│                             │
├─────────────────────────────┤
│                             │
│  [AI点评] [保存图片] [分享]  │
│                             │
│     [ 发布到广场 ] 🎯       │
│                             │
└─────────────────────────────┘

✅ Toast: "已保存到你的诗集"
```

**4个按钮说明**：
1. **AI 点评** → 显示 AI 点评弹窗
2. **保存图片** → 保存到相册
3. **分享** → 唤醒系统分享面板（微信/朋友圈等）
4. **发布到广场** → 上传到云端广场（需登录）

---

## 👤 我的页面流程

### 布局
```
┌─────────────────────────────┐
│  我的                       │
├─────────────────────────────┤
│  笔名 & 称号                │
│  统计信息                   │
├─────────────────────────────┤
│  [诗集] [草稿] [已发布]     │
├─────────────────────────────┤
│  📄 诗歌卡片 1              │
│  📄 诗歌卡片 2              │
│  📄 诗歌卡片 3              │
└─────────────────────────────┘
```

---

## 📚 诗集 Tab 流程

### 1. 点击卡片 → 查看详情
```
┌─────────────────────────────┐
│  [<]      诗歌详情          │
├─────────────────────────────┤
│                             │
│      《标题》               │
│                             │
│     正文内容...             │
│                             │
│   创作方式 · 日期           │
│                             │
├─────────────────────────────┤
│                             │
│    [ 编辑 ]  [ 发布 ]       │
│                             │
│        [ AI 点评 ]          │
│                             │
└─────────────────────────────┘
```

**3个按钮**：
1. **编辑** → 进入编辑模式
2. **发布到广场** → 发布/已发布状态
3. **AI 点评** → AI 点评弹窗

---

### 2. 点击"编辑" → 进入编辑模式

#### 场景 A：未修改
```
┌─────────────────────────────┐
│         编辑诗歌            │
├─────────────────────────────┤
│                             │
│   标题：标题内容_______      │
│                             │
│   正文：                    │
│   正文内容__________        │
│   ____________________      │
│                             │
│                             │
│         [ 退出 ]            │ ← 未修改，显示"退出"
│                             │
└─────────────────────────────┘
```

#### 场景 B：已修改
```
┌─────────────────────────────┐
│         编辑诗歌            │
├─────────────────────────────┤
│                             │
│   标题：新标题_________      │
│                             │
│   正文：                    │
│   修改后的正文_______        │
│   ____________________      │
│                             │
│                             │
│         [ 保存 ]            │ ← 已修改，显示"保存"
│                             │
└─────────────────────────────┘

→ 点击"保存"后
  ✅ 显示诗歌图片（同写诗页面）
  ✅ Toast: "已保存到你的诗集"
  ✅ 底部4个按钮（AI点评/保存图片/分享/发布）
```

---

### 3. 点击"发布到广场"

#### 场景 A：未发布
```
→ 未登录：弹出登录页面
→ 已登录：直接发布

✅ 发布成功
✅ Toast: "已发布到广场"
✅ 按钮变为：[✓ 已发布广场]（不可点击/灰色）
```

#### 场景 B：已发布
```
┌─────────────────────────────┐
│    [ 编辑 ]  [ ✓ 已发布 ]   │ ← 灰色/不可点击
│        [ AI 点评 ]          │
└─────────────────────────────┘

✅ 点击时 Toast: "该诗歌已发布到广场"
```

---

## 📋 草稿 Tab 流程

### 点击卡片 → 直接进入编辑
```
┌─────────────────────────────┐
│  [取消]    编辑草稿          │
├─────────────────────────────┤
│                             │
│   标题：________________    │
│                             │
│   正文：                    │
│   ____________________      │
│   ____________________      │
│                             │
│                             │
│         [ 保存 ]            │ ← 点击后同写诗页面
│                             │
└─────────────────────────────┘

→ 点击"取消"
  选项：[删除草稿] [继续编辑]

→ 点击"保存"
  ✅ 显示诗歌图片
  ✅ Toast: "已保存到你的诗集"
  ✅ 底部4个按钮
  ✅ 从草稿移动到诗集
```

---

## 📢 已发布 Tab 流程

### 点击卡片 → 查看详情（只读）
```
┌─────────────────────────────┐
│  [<]      诗歌详情          │
├─────────────────────────────┤
│                             │
│      《标题》               │
│                             │
│     正文内容...             │
│                             │
│   👍 123  💬 45  ⭐ 67      │ ← 广场互动数据
│                             │
├─────────────────────────────┤
│                             │
│   [ 查看广场讨论 ]          │
│                             │
│      [ AI 点评 ]            │
│                             │
└─────────────────────────────┘
```

**说明**：
- 已发布的诗歌不可编辑
- 可查看广场互动数据
- 可触发 AI 点评
- 不显示"分享"按钮（避免重复）

---

## 🔄 完整流程图

```
写诗页面
  │
  ├─ [保存] → 显示图片 → 4个按钮
  │             │
  │             ├─ AI点评
  │             ├─ 保存图片
  │             ├─ 分享
  │             └─ 发布广场 → 云端 + 已发布Tab
  │
  └─ [取消/退出] → 自动草稿 → 草稿Tab


我的 - 诗集Tab
  │
  └─ 点击卡片 → 详情页 → 3个按钮
                  │
                  ├─ 编辑 → 编辑模式
                  │          │
                  │          ├─ 未修改 → [退出]
                  │          └─ 已修改 → [保存] → 图片 + 4按钮
                  │
                  ├─ 发布广场 → 云端 + 已发布Tab
                  │              └─ 已发布 → 置灰 + Toast
                  │
                  └─ AI点评


我的 - 草稿Tab
  │
  └─ 点击卡片 → 编辑模式 → [保存] → 图片 + 4按钮
                            → 移动到诗集Tab


我的 - 已发布Tab
  │
  └─ 点击卡片 → 详情页（只读） → 2个按钮
                              │
                              ├─ 查看广场讨论
                              └─ AI点评
```

---

## ❓ 需要确认的细节

### 1. "保存图片"按钮
**Q**: 这个按钮是保存生成的诗歌图片到相册吗？
- [ ] 是，保存到相册
- [ ] 否，其他功能：__________

### 2. 草稿的"取消"行为
**Q**: 草稿编辑时点"取消"，是否需要确认？
- [ ] 需要弹窗：[删除草稿] [继续编辑]
- [ ] 直接退出，保留草稿

### 3. 已发布的诗歌
**Q**: 已发布的诗歌是否可以编辑？
- [ ] 不可编辑（当前方案）
- [ ] 可编辑，但编辑后需要"重新发布"

### 4. 编辑后的"退出"按钮
**Q**: 编辑模式下，未修改时点"退出"，是否需要确认？
- [ ] 直接退出
- [ ] 弹窗确认

### 5. 诗集卡片的删除操作
**Q**: 诗集的诗歌如何删除？
- [ ] 长按卡片 → 删除菜单
- [ ] 详情页添加"删除"按钮
- [ ] Swipe 左滑删除

### 6. 图片生成时机
**Q**: 诗歌图片是实时生成还是点击"保存"后生成？
- [ ] 点击"保存"后立即生成
- [ ] 点击"分享"或"保存图片"时才生成

### 7. 发布后的编辑
**Q**: 如果在诗集Tab编辑了已发布的诗歌，云端数据如何处理？
- [ ] 不允许编辑已发布的诗歌
- [ ] 允许编辑，但不同步到云端（本地和云端分离）
- [ ] 允许编辑，自动更新云端数据

---

## 🎨 视觉原型图（待画）

我会在你确认上述细节后，画出详细的交互原型图。

---

## 📊 与现有逻辑的对比

| 功能 | 现状 | 新方案 |
|------|------|--------|
| 写诗保存按钮 | 3个（草稿/诗集/发布） | 1个（保存） |
| 未保存退出 | 弹窗选择 | 自动草稿 |
| 保存后操作 | 诗集显示分享，其他直接关闭 | 统一显示图片+4按钮 |
| 诗集编辑 | 底部固定按钮 | 未修改=退出，已修改=保存 |
| 编辑后保存 | 直接保存关闭 | 显示图片+4按钮 |
| 草稿编辑 | 查看详情→编辑 | 直接进入编辑 |
| 数据存储 | 登录前后不一致 | 统一本地（除广场） |

---

## ✅ 优势

1. **逻辑统一**：保存后都显示图片+4按钮
2. **减少混淆**：只有一个"保存"按钮
3. **自动草稿**：不会丢失内容
4. **编辑明确**：未修改=退出，已修改=保存
5. **数据简化**：本地为主，云端仅广场

---

## 🚧 需要修改的文件

### 写诗页面（3个文件）
- `DirectWritingView.swift`
- `MimicWritingView.swift`
- `ThemeWritingView.swift`

### 我的页面（2个文件）
- `ProfileView.swift`
- `PoemEditorDetailView.swift`

### 新增组件
- `PoemImageView.swift`（生成诗歌图片）
- `PoemSuccessSheet.swift`（保存成功页面）

---

## 📝 请回答上述7个问题

确认这些细节后，我会：
1. 画出完整的交互原型图
2. 制定详细的开发计划
3. 开始逐步实现

你觉得这个方案如何？有没有需要调整的地方？

