# 📝 编辑器重构产品文档

## 🎯 设计目标

**极简化创作流程**：去掉模式选择，直接进入编辑器，AI辅助功能通过一个智能灯泡按钮提供。

---

## 📊 当前流程 vs 新流程

### 当前流程（复杂）
```
点击"写诗" 
  ↓
【模式选择页面】
  ├─ 直接写诗
  ├─ 临摹写诗
  ├─ 主题写诗
  └─ 【了解现代诗】模块
  ↓
选择模式后进入编辑器
```

### 新流程（极简）
```
点击"写诗"
  ↓
【直接进入编辑器】
  └─ 右下角：💡 按钮（智能切换）
     ├─ 未编辑时：点击显示AI主题思路
     └─ 已编辑时：点击显示AI续写灵感
  ↓
【设置页面】
  └─ 【了解现代诗】模块
```

---

## 🎨 界面原型

### 1. 写诗入口（保持不变）

```
┌─────────────────────────┐
│  诗集                    │
│                         │
│  [诗歌列表...]          │
│                         │
│         ┌─────┐         │
│         │写诗 │         │ ← 点击这里
│         └─────┘         │
└─────────────────────────┘
```

---

### 2. 编辑器页面（核心变化）

#### 2.1 初始状态（用户还没开始写）

```
┌─────────────────────────┐
│  ← 取消    直接写诗  保存 │
├─────────────────────────┤
│                         │
│                         │
│    [标题输入框]          │
│                         │
│    [内容输入框]          │
│    在这里写下你的诗...   │
│                         │
│                         │
│                         │
│                         │
│                    ┌─┐  │
│                    │💡│ │ ← 灯泡按钮（点击获取主题思路）
│                    └─┘  │
└─────────────────────────┘
```

**功能说明**：
- 用户还没输入任何内容
- 右下角显示 **💡** 按钮
- 点击 **💡** → 弹出AI主题思路（弹窗形式，不修改编辑器）
- 用户关闭弹窗后，可以继续点击获取新主题，或直接开始写

---

#### 2.2 编辑状态（用户开始写了）

```
┌─────────────────────────┐
│  ← 取消    直接写诗  保存 │
├─────────────────────────┤
│                         │
│    城市夜晚              │
│                         │
│    路灯一盏盏亮起        │
│    像是在点名            │
│                         │
│    却没有人             │
│    应答                  │
│                         │
│                         │
│                    ┌─┐  │
│                    │💡│ │ ← 灯泡按钮（点击获取续写灵感）
│                    └─┘  │
└─────────────────────────┘
```

**功能说明**：
- 用户已经开始输入内容（标题或正文有内容）
- 右下角显示 **💡** 按钮（同一个按钮，功能自动切换）
- 点击 **💡** → 弹出AI续写灵感（深度分析 + 续写建议）
- 右上角"保存"按钮可用

---

### 3. 设置页面（新增模块）

```
┌─────────────────────────┐
│  ← 设置                  │
├─────────────────────────┤
│                         │
│  [个人信息区]            │
│                         │
│  [会员状态卡片]          │
│                         │
│  ┌───────────────────┐  │
│  │ 了解现代诗         │  │ ← 新增
│  │ →                 │  │
│  └───────────────────┘  │
│                         │
│  [其他设置项...]         │
│                         │
└─────────────────────────┘
```

**功能说明**：
- 将【了解现代诗】模块移到设置页面
- 点击后进入学习内容页面（保持原有功能）

---

## 🔄 交互流程

### 流程1：用户直接开始写

```
1. 点击"写诗"
   ↓
2. 直接进入编辑器（空白状态）
   ↓
3. 右下角显示 💡 按钮
   ↓
4. 用户直接开始输入
   ↓
5. 💡 按钮功能自动切换（主题思路 → 续写灵感）
   ↓
6. 用户可以：
   - 继续写
   - 点击 💡 获取续写灵感
   - 点击"保存"完成
```

### 流程2：用户先获取主题思路

```
1. 点击"写诗"
   ↓
2. 直接进入编辑器（空白状态）
   ↓
3. 右下角显示 💡 按钮
   ↓
4. 用户点击 💡 按钮
   ↓
5. 弹出AI主题思路（弹窗）
   ├─ 主题：如"城市夜晚"
   ├─ 引导：如"观察城市中的光影..."
   └─ [关闭] 按钮
   ↓
6. 用户关闭弹窗
   ↓
7. 用户可以：
   - 再次点击 💡 获取新主题
   - 直接开始写（主题只是参考，不写入编辑器）
   ↓
8. 用户开始输入后，💡 按钮功能切换为续写灵感
```

---

## 🎯 功能对比

| 功能 | 当前 | 新设计 |
|------|------|--------|
| **入口** | 模式选择页面 | 直接进入编辑器 |
| **直接写诗** | ✅ 独立模式 | ✅ 默认模式 |
| **主题写诗** | ✅ 独立模式 | ✅ 💡 按钮（未编辑时） |
| **临摹写诗** | ✅ 独立模式 | ❌ 移除 |
| **AI续写灵感** | ✅ 编辑器内 | ✅ 💡 按钮（已编辑时） |
| **了解现代诗** | ✅ 写诗入口页 | ✅ 设置页面 |
| **按钮数量** | 3个模式 + 1个灵感按钮 | 1个智能按钮（💡） |

---

## 📱 详细交互设计

### 💡 智能灯泡按钮（核心功能）

**按钮特点**：
- 始终显示在编辑器右下角
- 根据编辑器状态自动切换功能
- 同一个按钮，两种模式

---

### 模式1：未编辑时（AI主题思路）

**显示条件**：
- 编辑器为空（标题和内容都为空）

**点击行为**：
```
点击 💡 按钮
  ↓
显示加载状态（💡 按钮转圈）
  ↓
调用 AI 生成主题思路
  ↓
弹出弹窗：
┌─────────────────────────┐
│  ✨ AI 主题思路          │
├─────────────────────────┤
│                         │
│  主题：城市夜晚          │
│                         │
│  引导：观察城市中的光影  │
│  和声音，捕捉那些被忽略  │
│  的瞬间...              │
│                         │
│  ┌─────────┐            │
│  │  关闭   │            │
│  └─────────┘            │
└─────────────────────────┘
```

**交互说明**：
- **关闭**：关闭弹窗，主题只是参考，不写入编辑器
- **换主题**：关闭弹窗后，再次点击 💡 按钮即可获取新主题
- 用户可以直接开始写，也可以继续获取新主题

**限制**：
- 免费用户：每天2次
- 会员：无限次

---

### 模式2：已编辑时（AI续写灵感）

**显示条件**：
- 用户已经开始输入（标题或内容有内容）

**点击行为**：
```
点击 💡 按钮
  ↓
显示加载状态（💡 按钮转圈）
  ↓
调用 AI 深度分析 + 续写建议
  ↓
弹出弹窗：
┌─────────────────────────┐
│  ✨ 创作灵感             │
├─────────────────────────┤
│                         │
│  你想表达的是...        │
│                         │
│  用词方面，"XX"很好...  │
│                         │
│  意象上，你用了...      │
│                         │
│  续写建议：一是...      │
│  二是...                │
│                         │
│  ┌─────────┐            │
│  │  知道了 │            │
│  └─────────┘            │
└─────────────────────────┘
```

**交互说明**：
- **知道了**：关闭弹窗，继续创作
- 建议只是参考，不自动写入编辑器

**限制**：
- 免费用户：每周2次
- 会员：无限次

---

### 状态切换逻辑

```
编辑器状态检测：
  if (标题为空 && 内容为空) {
    💡 按钮功能 = "AI主题思路"
  } else {
    💡 按钮功能 = "AI续写灵感"
  }
```

**切换时机**：
- 用户开始输入第一个字符时，立即切换
- 用户清空所有内容时，立即切换回主题思路模式

---

## 🗑️ 移除的功能

### 1. 临摹写诗模式（MimicWritingView）
- **原因**：使用频率低，增加复杂度
- **影响**：相关代码和UI全部移除

### 2. 主题写诗模式（ThemeWritingView）
- **原因**：功能整合到 💡 按钮中
- **影响**：移除独立页面，保留AI服务功能

### 3. 模式选择页面（CreateModeSelectorView）
- **原因**：直接进入编辑器更简单
- **影响**：移除模式选择页面

### 4. 写诗入口页的【了解现代诗】模块
- **原因**：移到设置页面，减少入口页复杂度
- **影响**：从 WritingView 移除，添加到 SettingsView

### 5. 三种编辑器状态
- **原因**：统一为一个编辑器，通过按钮功能切换
- **影响**：移除模式相关的状态管理

---

## 📝 技术实现要点

### 1. 编辑器状态管理

```swift
@State private var hasContent: Bool {
    !title.trimmingCharacters(in: .whitespaces).isEmpty ||
    !content.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty
}

// 💡 按钮功能切换逻辑
var lightbulbButtonFunction: LightbulbFunction {
    hasContent ? .writingInspiration : .themeGuidance
}

enum LightbulbFunction {
    case themeGuidance    // AI主题思路
    case writingInspiration // AI续写灵感
}
```

### 2. 💡 按钮点击处理

```swift
func handleLightbulbTap() {
    if hasContent {
        // 调用续写灵感
        requestWritingInspiration()
    } else {
        // 调用主题思路
        requestThemeGuidance()
    }
}
```

### 3. AI主题思路功能

- 复用 `AIService.generatePoemThemeWithGuidance()`
- 弹窗显示主题和引导（只显示，不写入编辑器）
- 用户关闭弹窗即可，无需"使用主题"选项

### 4. AI续写灵感功能

- 使用改进后的 `AIService.getWritingInspiration()`
- 提供深度分析和续写建议
- 弹窗显示，不自动写入编辑器

### 5. 路由简化

```
旧：首页 → 模式选择 → 编辑器（3种模式）
新：首页 → 编辑器（统一）
```

### 6. 编辑器统一

- 只保留 `DirectWritingView` 作为唯一编辑器
- 移除 `MimicWritingView` 和 `ThemeWritingView`
- 通过 💡 按钮功能切换实现不同AI辅助

---

## ✅ 优势总结

1. **极简入口**：点击"写诗"直接进入编辑器，减少一步操作
2. **一个按钮**：统一的 💡 按钮，根据状态智能切换功能
3. **按需使用AI**：用户可以选择是否使用AI辅助，不强制
4. **不干扰创作**：AI建议只以弹窗显示，不自动写入编辑器
5. **功能集中**：学习内容移到设置，入口页更专注
6. **减少选择**：去掉模式选择，降低认知负担
7. **统一体验**：所有创作都在同一个编辑器中完成

---

## ❓ 待确认问题

1. **主题显示方式**：✅ 已确认 - 主题只以弹窗显示，不写入编辑器，用户关闭弹窗即可

2. **临摹写诗数据**：如果用户之前有临摹写诗的数据，如何处理？
   - 选项A：保留数据，但不再显示（推荐）
   - 选项B：迁移为普通诗歌 ✅ 已确认 
   - 选项C：删除

3. **💡 按钮样式**：按钮的具体样式？
   - 选项A：系统图标（SF Symbols `lightbulb`）
   - 选项B：自定义图标
   - 选项C：文字按钮
   - 选项D：保持不变 ，现在就有这个按钮 ✅

4. **弹窗样式**：主题思路和续写灵感的弹窗是否使用相同样式？
   - 选项A：相同样式，统一体验（推荐） ✅ ok 的
   - 选项B：不同样式，区分功能

---

## 📋 开发清单

### 第一阶段：移除旧功能
- [ ] 移除模式选择页面（CreateModeSelectorView）
- [ ] 移除临摹写诗功能（MimicWritingView）
- [ ] 移除主题写诗页面（ThemeWritingView）
- [ ] 移除写诗入口页的【了解现代诗】模块

### 第二阶段：重构编辑器
- [ ] 修改写诗入口，直接进入编辑器（DirectWritingView）
- [ ] 实现编辑器状态检测（hasContent）
- [ ] 实现 💡 按钮功能切换逻辑
- [ ] 实现 💡 按钮点击处理（根据状态调用不同AI功能）

### 第三阶段：AI功能整合
- [ ] 实现 💡 按钮（未编辑时）→ AI主题思路弹窗
- [ ] 实现 💡 按钮（已编辑时）→ AI续写灵感弹窗
- [ ] 统一弹窗样式和交互

### 第四阶段：设置页面
- [ ] 将【了解现代诗】添加到设置页面
- [ ] 添加导航链接

### 第五阶段：清理和优化
- [ ] 更新路由和导航逻辑
- [ ] 处理旧数据迁移（临摹写诗数据）
- [ ] 清理无用代码和资源
- [ ] 测试所有功能

---

**文档版本**：v1.0  
**创建时间**：2025-01-XX  
**待确认**：请确认以上设计是否符合预期，特别是"待确认问题"部分

