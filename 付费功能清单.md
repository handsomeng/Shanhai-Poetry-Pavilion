# 山海诗馆 - 付费功能完整清单

> 更新时间：2025-10-29  
> 版本：v1.0

---

## 📊 付费功能总览

| 功能 | 免费用户 | 会员用户 | 实现位置 |
|------|---------|---------|---------|
| **AI 点评** | 3次/天 | 无限次 | MyPoemDetailView.swift |
| **AI 续写灵感** | 2次/天 | 无限次 | PoemTextEditorViewController.swift |
| **AI 生成主题** | ❌ 不可用 | ✅ 无限次 | ThemeWritingView.swift |
| **AI 示例诗** | ❌ 不可用 | ✅ 无限次 | MimicWritingView.swift |
| **图片风格** | 1种（基础） | 6+种 | SubscriptionManager |
| **字体样式** | 1种（宋体） | 8+种 | SubscriptionManager |
| **无广告** | ❌ 有广告 | ✅ 无广告 | - |
| **会员标识** | ❌ 无 | ✅ 专属标识 | - |

---

## 💰 订阅价格

| 套餐 | 价格 | 月均 | 优惠 | Badge |
|------|------|------|------|-------|
| **月卡** | ¥9.9/月 | ¥9.9 | - | - |
| **季卡** | ¥19.9/季 | ¥6.6 | 省33% | 推荐 |
| **年卡** | ¥69.9/年 | ¥5.8 | 省41% | 最划算 |

**免费试用**：所有套餐均可享受 7 天免费试用

---

## 📋 详细功能说明

### 1. AI 点评（免费 3次/天）

**功能位置**：诗歌详情页 → 右上角菜单 → AI 诗评

**实现逻辑**：
```swift
// SubscriptionManager.swift
- dailyAICommentCount: 追踪使用次数
- maxFreeAIComments = 3
- canUseAIComment(): 检查是否可用
- useAIComment(): 消耗一次
- remainingAIComments(): 查询剩余次数
```

**提示文案**：
- 达到限制："今日 AI 点评次数已用完（3/3）"
- 引导升级："升级会员即可无限使用 AI 点评 ✨"

**消耗时机**：成功获取 AI 点评后

---

### 2. AI 续写灵感（免费 2次/天）

**功能位置**：写诗页面 → 右下角灯泡按钮

**实现逻辑**：
```swift
// SubscriptionManager.swift
- dailyInspirationCount: 追踪使用次数
- maxFreeInspirations = 2
- canUseInspiration(): 检查是否可用
- useInspiration(): 消耗一次
- remainingInspirations(): 查询剩余次数
```

**提示文案**：
- 达到限制："今日次数已用完"
- 说明："免费用户每天可使用 2 次 AI 续写灵感"
- 引导升级："升级会员即可无限使用 ✨"

**消耗时机**：成功获取续写灵感后

---

### 3. AI 生成主题（仅会员）

**功能位置**：学诗页面 → 主题写诗 → 开始创作

**实现逻辑**：
```swift
// ThemeWritingView.swift
guard subscriptionManager.isSubscribed else {
    showingSubscription = true  // 直接跳转订阅页面
    return
}
```

**提示文案**：
- 非会员点击：直接弹出订阅页面
- 订阅页面标题："解锁 AI 生成主题"

**消耗时机**：不计次，会员无限使用

---

### 4. AI 示例诗（仅会员）

**功能位置**：学诗页面 → 临摹写诗 → 开始创作

**实现逻辑**：
```swift
// MimicWritingView.swift
guard subscriptionManager.isSubscribed else {
    showingSubscription = true  // 直接跳转订阅页面
    return
}
```

**提示文案**：
- 非会员点击：直接弹出订阅页面
- 订阅页面标题："解锁 AI 示例诗"

**消耗时机**：不计次，会员无限使用

---

### 5. 高级图片风格（仅会员）

**可用风格**：
- 免费：基础风格
- 会员：水墨、花卉、古典、山水、现代（共6+种）

**实现逻辑**：
```swift
// SubscriptionManager.swift
func canUseImageStyle(_ style: ImageStyle) -> Bool {
    !style.isPremium || isSubscribed
}
```

---

### 6. 字体样式（仅会员）

**可用字体**：
- 免费：宋体
- 会员：楷体、行楷、隶书等（共8+种）

**实现逻辑**：
```swift
// SubscriptionManager.swift
func canUseFontStyle(_ font: PoemFont) -> Bool {
    !font.isPremium || isSubscribed
}
```

---

## 🔄 每日重置逻辑

**重置时间**：每天 00:00（系统时间）

**重置内容**：
- AI 点评次数：3/3
- AI 续写灵感次数：2/2

**实现方式**：
```swift
// SubscriptionManager.swift
private func checkAndResetDailyLimit() {
    let today = Calendar.current.startOfDay(for: Date())
    
    if lastResetDate < today {
        // 新的一天，重置计数
        dailyAICommentCount = 0
        dailyInspirationCount = 0
    }
}
```

**调用时机**：
- App 启动时
- 每次检查使用权限时

---

## 💡 用户体验设计

### 限制提示策略

| 场景 | 提示方式 | 行动按钮 |
|------|---------|---------|
| 免费次数用完 | Alert 弹窗 | [取消] [升级会员] |
| 会员功能未解锁 | 直接跳转订阅页 | - |
| 成功使用 | Toast 提示（可选） | - |

### 引导文案原则

1. **简洁明了**：一句话说清限制
2. **积极鼓励**：用"升级会员"而非"需要付费"
3. **突出价值**："无限使用"而非"解除限制"
4. **Emoji 点缀**：✨ 营造高级感

---

## 🧪 测试检查清单

### 免费用户测试

- [ ] AI 点评：第3次成功，第4次提示限制
- [ ] 续写灵感：第2次成功，第3次提示限制
- [ ] 主题生成：点击直接跳转订阅页
- [ ] 示例诗：点击直接跳转订阅页
- [ ] 次日00:00后，次数重置

### 会员用户测试

- [ ] AI 点评：无限使用，不计次
- [ ] 续写灵感：无限使用，不计次
- [ ] 主题生成：直接可用
- [ ] 示例诗：直接可用
- [ ] 会员标识正确显示

### 边界情况

- [ ] 订阅过期后，次数限制恢复
- [ ] 首次使用，显示正确的剩余次数
- [ ] App 被杀死后重启，次数记录正确
- [ ] 跨时区场景，重置逻辑正确

---

## 📱 App Store 展示

### 会员权益描述（建议更新）

**原文**：
> AI 点评无限次（免费用户每天仅 3 次）

**建议改为**：
> ✨ AI 功能无限使用
> - AI 点评无限次（免费 3次/天）
> - AI 续写灵感无限次（免费 2次/天）
> - AI 生成主题（仅会员）
> - AI 示例诗（仅会员）

---

## 🚀 上线前检查

### 代码层面

- [x] 所有 AI 功能都有付费保护
- [x] 每日重置逻辑正确
- [x] 会员状态检查正确
- [x] 错误处理完善

### 文案层面

- [ ] SubscriptionProduct.swift 中的权益描述
- [ ] SettingsView 中的会员卡片文案
- [ ] 订阅页面的权益列表
- [ ] Toast/Alert 提示文案

### 测试层面

- [ ] 沙盒环境订阅测试
- [ ] 免费用户限制测试
- [ ] 会员用户无限测试
- [ ] iPad 兼容性测试

---

## 🎯 未来优化方向

1. **更灵活的限制**：
   - 考虑根据用户活跃度调整免费次数
   - VIP 用户额外加成

2. **限制提示优化**：
   - 在达到80%时提前提醒
   - 展示「今日还剩 X 次」

3. **订阅引导优化**：
   - 从限制弹窗直接跳转订阅页
   - 预填选中推荐套餐

4. **数据分析**：
   - 追踪各功能使用频率
   - 分析付费转化漏斗

---

## ✅ 总结

**付费逻辑清晰度**：⭐⭐⭐⭐⭐

- 所有 AI 功能均有付费保护
- 免费用户有合理的试用额度
- 会员用户享受无限使用
- 提示文案友好且引导明确

**建议**：
- 可以正式提交审核 ✅
- 记得更新会员权益描述文案
- 准备好沙盒测试账号

**预期效果**：
- 免费用户：每天可体验核心功能
- 付费意愿：AI 限制达到后，转化率预期 10-15%
- 用户满意度：合理的限制 + 清晰的价值

---

**祝发布顺利！** 🎉

