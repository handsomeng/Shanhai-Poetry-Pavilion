# 山海诗馆 - 订阅审核问题修复指南

**问题类型**: Guideline 3.1.2 - Business - Payments - Subscriptions  
**拒绝日期**: 2025年11月5日  
**修复状态**: ✅ 已完成所有代码修改

---

## 📋 问题总结

Apple 审核团队指出:

> **The app's metadata is missing the following required information:**
> 
> - A functional link to the Terms of Use (EULA)
> - A functional link to the privacy policy in the Privacy Policy field in App Store Connect

**核心问题**: 应用提供自动续期订阅功能,但缺少必需的用户协议和隐私政策链接。

---

## ✅ 已完成的代码修改

### 1. 修改订阅页面链接 (SubscriptionView.swift)

**修改前** ❌:
```swift
// 链接指向 Apple 的标准协议
Button(action: {
    if let url = URL(string: "https://www.apple.com/legal/internet-services/itunes/dev/stdeula/") {
        UIApplication.shared.open(url)
    }
}) {
    Text("用户协议")
}
```

**修改后** ✅:
```swift
// 链接指向 App 内部页面
NavigationLink(destination: TermsOfServiceView()) {
    Text("用户协议")
}
```

### 2. 更新隐私政策 (PrivacyPolicyView.swift)

增加了 **"7. 订阅与支付"** 章节:
- 订阅信息通过 Apple 的 StoreKit 处理
- 我们不会存储您的支付信息
- 订阅管理由 App Store 统一处理
- 您可以随时取消订阅

### 3. 更新用户协议 (TermsOfServiceView.swift)

增加了 **"7. 自动续期订阅条款"** 完整章节:
- ✅ 订阅类型和价格（月度、季度、年度）
- ✅ 免费试用说明（7天免费）
- ✅ 自动续费规则
- ✅ 管理和取消订阅的详细步骤
- ✅ 退款政策
- ✅ 会员权益详细说明

### 4. 更新项目根目录文档

同步更新了以下Markdown文件(用于GitHub托管):
- ✅ `PRIVACY_POLICY.md`
- ✅ `TERMS_OF_SERVICE.md`

---

## 🚀 App Store Connect 配置步骤

### 第一步: 上传代码到GitHub

为了让 Apple 审核团队能访问隐私政策和用户协议,需要先将更新后的文件推送到GitHub:

```bash
cd /Users/handsomeng/Downloads/vibe-coding/BetweenLines/BetweenLines

# 添加修改的文件
git add .

# 提交更改
git commit -m "修复订阅审核问题: 更新隐私政策和用户协议,增加订阅条款"

# 推送到远程仓库
git push origin main
```

### 第二步: 确认GitHub URL

推送成功后,确认以下URL可以访问:

**隐私政策URL**:
```
https://raw.githubusercontent.com/你的用户名/你的仓库名/main/PRIVACY_POLICY.md
```

**用户协议URL**:
```
https://raw.githubusercontent.com/你的用户名/你的仓库名/main/TERMS_OF_SERVICE.md
```

> **注意**: 将 `你的用户名` 和 `你的仓库名` 替换为实际的GitHub信息。
> 
> 根据你的文档,仓库应该是: `handsomeng/Shanhai-Poetry-Pavilion`
>
> 所以URL应该是:
> - 隐私政策: `https://raw.githubusercontent.com/handsomeng/Shanhai-Poetry-Pavilion/main/PRIVACY_POLICY.md`
> - 用户协议: `https://raw.githubusercontent.com/handsomeng/Shanhai-Poetry-Pavilion/main/TERMS_OF_SERVICE.md`

### 第三步: 配置 App Store Connect

1. 登录 [App Store Connect](https://appstoreconnect.apple.com)
2. 选择"山海诗馆"应用
3. 进入"App 信息"页面

#### 配置隐私政策URL

在"隐私政策"字段中填写:
```
https://raw.githubusercontent.com/handsomeng/Shanhai-Poetry-Pavilion/main/PRIVACY_POLICY.md
```

#### 配置用户协议

有两种选择:

**选项1 (推荐)**: 在"App 描述"中添加以下文字:
```
【用户协议】
本应用使用Apple标准最终用户许可协议(EULA)。
完整用户协议请访问: https://raw.githubusercontent.com/handsomeng/Shanhai-Poetry-Pavilion/main/TERMS_OF_SERVICE.md
```

**选项2**: 在App Store Connect的"EULA"字段中上传自定义EULA文本(需要复制TERMS_OF_SERVICE.md的全部内容)

---

## 📝 回复审核团队

在 App Store Connect 的"审核信息"或"消息"中回复:

```
尊敬的审核团队,

感谢您的反馈。我们已经完成了以下修改来解决 Guideline 3.1.2 的问题:

【已修复的问题】

1. ✅ 订阅页面中的"用户协议"和"隐私政策"链接已改为指向应用内部页面
   - 用户点击后可以直接在App内查看完整的协议内容
   
2. ✅ 隐私政策已增加"订阅与支付"章节
   - 详细说明了订阅信息的处理方式
   - 明确我们不存储支付信息
   - 说明了如何管理和取消订阅

3. ✅ 用户协议已增加完整的"自动续期订阅条款"章节,包括:
   - 订阅类型和价格(月度¥9.9、季度¥19.9、年度¥69.9)
   - 7天免费试用说明
   - 自动续费规则和扣费时间
   - 详细的取消订阅步骤
   - 退款政策
   - 完整的会员权益说明

4. ✅ App Store Connect 已配置隐私政策URL和用户协议链接

【应用内订阅信息展示】

在订阅页面中,我们清晰展示了以下必需信息:
- ✅ 订阅标题: "山海诗馆会员"
- ✅ 订阅时长: 月度/季度/年度
- ✅ 订阅价格: ¥9.9/月、¥19.9/季、¥69.9/年
- ✅ 免费试用: "免费试用 7 天"
- ✅ 隐私政策链接: 指向App内页面
- ✅ 用户协议链接: 指向App内页面

【测试说明】

审核时请注意:
1. 在订阅页面底部可以看到"用户协议"和"隐私政策"链接
2. 点击后会进入App内部页面,可以完整查看协议内容
3. 设置页面中也可以随时访问这些协议

我们确信这些修改已经完全符合 Guideline 3.1.2 的要求。如有任何问题,请随时联系我们。

此致
山海诗馆开发团队
martinwm2011@hotmail.com
```

---

## ✅ 提审前最终检查清单

### 代码检查

- [x] SubscriptionView.swift 中的链接已改为 NavigationLink
- [x] PrivacyPolicyView.swift 包含订阅与支付章节
- [x] TermsOfServiceView.swift 包含完整的订阅条款
- [x] 所有订阅信息(价格、时长、标题)在UI中清晰展示

### 文档检查

- [ ] PRIVACY_POLICY.md 已更新并推送到GitHub
- [ ] TERMS_OF_SERVICE.md 已更新并推送到GitHub
- [ ] GitHub URL 可以正常访问

### App Store Connect 配置

- [ ] 隐私政策URL已填写
- [ ] 用户协议已在App描述或EULA字段中说明
- [ ] 订阅价格信息正确
- [ ] 截图和描述已更新(如需要)

### 功能测试

- [ ] 在真机上测试订阅流程
- [ ] 点击订阅页面的"用户协议"链接,确认可以正常跳转
- [ ] 点击订阅页面的"隐私政策"链接,确认可以正常跳转
- [ ] 在设置页面中也能访问协议
- [ ] 订阅页面显示所有必需信息(价格、时长、免费试用)

---

## 🎯 重新提交步骤

### 1. 编译和Archive

```bash
# 在Xcode中
1. 选择 Generic iOS Device
2. Product → Clean Build Folder
3. Product → Archive
4. 等待Archive完成
```

### 2. 上传到App Store Connect

```bash
1. 在Organizer中选择最新的Archive
2. 点击 "Distribute App"
3. 选择 "App Store Connect"
4. 选择 "Upload"
5. 确认所有选项并上传
```

### 3. 提交审核

1. 等待构建版本处理完成(通常10-30分钟)
2. 在App Store Connect中选择"0.2"版本
3. 在"构建版本"中选择刚上传的版本
4. 填写"更新说明":

```
【v0.2 更新内容】

本次更新完善了订阅功能的协议说明:
- 完善了隐私政策,增加订阅与支付说明
- 完善了用户协议,增加详细的订阅服务条款
- 优化了订阅页面的协议链接
- 所有协议内容可在App内直接查看

感谢您的支持!
```

5. 在"审核信息备注"中粘贴上面的回复内容
6. 点击"提交以供审核"

---

## 📊 预期审核时间线

- **提交后**: 等待审核队列 (通常12-24小时)
- **审核中**: 1-2天
- **审核结果**: 如果没有其他问题,应该会通过

---

## 🔍 如果再次被拒

如果审核团队仍然有疑问,可能的原因和解决方案:

### 问题1: GitHub URL无法访问

**解决方案**:
- 确认仓库是公开的(Public),不是私有(Private)
- 检查文件路径是否正确
- 使用浏览器测试URL是否可以访问

### 问题2: 希望使用Apple标准EULA

**解决方案**:
如果审核团队建议使用Apple标准EULA而不是自定义协议,在App描述中添加:

```
本应用使用Apple标准最终用户许可协议。
详情请访问: https://www.apple.com/legal/internet-services/itunes/dev/stdeula/
```

### 问题3: 协议内容不够详细

**解决方案**:
- 联系审核团队,询问具体缺少什么内容
- 根据反馈进一步完善协议

---

## 💡 重要提示

1. **不要修改订阅价格**
   - 在审核期间不要修改App内购买的价格
   - 确保App内显示的价格和App Store Connect中配置的价格一致

2. **保持文档同步**
   - App内的协议内容应该和GitHub上的文档保持一致
   - 如果修改了协议,两边都要更新

3. **回复要及时**
   - 如果审核团队在消息中提问,尽快回复
   - 回复时态度诚恳,说明清楚

4. **准备演示**
   - 如果需要,可以录制演示视频展示协议链接的功能
   - 上传到YouTube或其他平台,发送给审核团队

---

## 📞 需要帮助?

如果在重新提交过程中遇到任何问题:

1. **检查控制台日志**: 确认没有运行时错误
2. **真机测试**: 在真实设备上完整测试订阅流程
3. **联系开发者**: martinwm2011@hotmail.com

---

## 🎉 成功提交后

一旦审核通过:

1. **监控用户反馈**: 关注App Store的评论和反馈
2. **监控Crash报告**: 确保应用稳定运行
3. **准备下一版本**: 根据用户反馈规划新功能

---

**祝你顺利通过审核! 🚀**

---

© 2025 山海诗馆开发团队  
最后更新: 2025年11月6日

